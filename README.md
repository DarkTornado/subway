# 전철 운행정보 API
© 2023 Dark Tornado, All rights reserved.

- 이곳저곳에서 수집한 정보를 종합하여 보여줍니다.
- 정보를 얻을 수 있는 경로가 없는 경우, 자체적으로 시간표 데이터를 구축해서 사용합니다.
- FastAPI 사용

## 정보 출처

### [서울시 지하철 실시간 위치 정보 Open API](https://data.seoul.go.kr/dataList/OA-12601/A/1/datasetView.do) 사용
 - 수도권 1 ~ 9 호선
 - 경의·중앙선
 - 수인·분당선
 - 신분당선
 - 경춘선
 - 경강선
 - 우이신선
 - 서해선
 - 공항철도

### [서울교통공사 홈페이지](https://smss.seoulmetro.co.kr/traininfo/traininfoUserView.do) 크롤링
 - 수도권 1, 4호선 급행 열차 위치 보정

### [용인경량전철주식회사 홈페이지](https://ever-line.co.kr/) 크롤링
 - 용인경전철 (에버라인)

### 시간표 기반 운행 정보
 - [인천 1 ~ 2호선](https://github.com/DarkTornado/ictr)
 - 신림선 : 실시간 열차 위치 정보 제공을 위해 협조 공문이 전달된 것으로 파악됨
 - 의정부경전철
 - 김포도시철도


## 서울시 지하철 실시간 위치 정보(이하 서울시 API) 버그 목록

### 열차 복사 버그
 - 같은 열차가 두 번 이상 포함되어 있음, 데이터 수집 시간은 다름.
 - 담당자가 `2023년 10월 13일`에 지속적으로 모니터링하겠다고 했는데, `아직도(2023년 11월)` 발생 중
 - 애초에 해당 현상은 `서울시 API가 정보를 받아오는 데이터 원천`에서 발생중
 - 더 최근에 수집된 데이터만 사용하도록 구현하여 해결

### 6호선 열차 복사 버그
 - 응암순환 구간에 열차가 진입해도 응암역에 여전히 열차가 있다고 뜨는 잔상(?) 발생
 - 열차가 응암역을 출발해서 응암순환으로 진입하면 헤당 열차의 행선지와 열차번호가 변경되는데, 시스템에서는 서로 다른 열차로 인식하는 듯
 - `응암역 열차 도착 정보`로 잔상을 삭제하는 방식으로 일단 해결, 순간적으로 잔상은 계속 남음

### 급행 열차 순간이동 버그
 - 급행 열차가 `급행 열차가 정차하는 역`에 도착해야 열차 위치가 갱신됨
 - e.g. `도안역`을 출발한 `동인천급행`이 `도화역`에 도착해도 여전히 `도안역`에 있다고 표시되며, `제물포역`에 진입해야 열차 위치 갱신
 - `도안역`과 `제물포역`은 `급행 열차가 정차하는 역`, `도화역`은 두 역 사이에 있는 `급행 열차가 동과하는 역`.
 - 한국철도공사(코레일)가 노선의 일부 또는 전체를 관할하는 노선에서만 발생함. 1, 4호선, 경의중앙선, 수인분당선, 경춘선에서 발생, 9호선에서는 발생하지 않음.
 - [서울교통공사 홈페이지](https://smss.seoulmetro.co.kr/traininfo/traininfoUserView.do)에서는 정상적으로 표시되기에, 1, 3, 4 호선은 홈페이지 크롤링으로 급행 열차 위치 보정
 - <s>사실 나머지도 수정할 수 있긴 한데 읍읍</s>

### 2호선 역 id 중복
 - 본선 성수역과 지선 성수역의 id가 동일
 - 본선 신도림역과 지선 신도림역의 id가 동일
 - 열차번호로 구분 완료
   - 2XXX, 3XXX, 4XXX, 6XXX, 7XXX, 8XXX : 본선 (을지로순환선)
   - 1XXX : 성수지선
   - 5XXX : 신정지선
   - 9XXX : 지선 임시열차

### 2호선 신정지선 상/하행 방향 반대
- 상/하행 정보를 반대로 줌

### 4호선 진접선 구간 정보 없음 (당고개 ~ 진접)
 - 당고개역 진입 이후에는 진접행 열차의 정보가 제공되지 않음
 - 진접선 구간은 남양주시의 협조가 있어야 실시간 운행 정보를 제공할 수 있다고 답변했는데, 정작 본인들이 만든 앱에서는 진접선 구간은 아주 잘 나옴.
 - 서울교통공사 홈페이지에도 진접선 구간이 잘 나오고 있기에, 크롤링으로 보정할 예정

### 우이신설선 상/하행 방향 반대
 - 상/하행 정보를 반대로 줌

### 서해선 일산 연장 미대응 - 2023년 11월 7일에 해결됨
 - `데이터 원천`에는 서해선 일산 연장 구간이 반영되어 있으나, `서울시 API`에는 2달 넘게 반영되지 않음
 - 일산행 열차는 행선지 정보(null)가 없음
 - 서해선이 일산역으로 연장되면서 서해선 전체 역 id가 4칸 뒤로 밀렸는데, `서울시 API`에서는 밀려난게 반영되지 않음
 - 사실 일산행 열차는 행선지 정보를 `역 id` 대신 `역 code`로 주고 있었으나, `역 code`는 `데이터 원천`에서 사용하는 값으로 `서울시 API`에서는 제공하지 않음.
